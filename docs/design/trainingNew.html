<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Essay Training Mode - Remedial English Course</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-hover': '#4a49c5',
                        'primary-light': '#ebebfa',
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .sentence-highlight {
            cursor: pointer;
            transition: all 0.2s;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .sentence-highlight:hover {
            background-color: rgba(93, 92, 222, 0.2);
        }
        .sentence-selected {
            background-color: rgba(93, 92, 222, 0.3);
            border-bottom: 2px solid #5D5CDE;
            font-weight: 500;
        }
        .nav-tab {
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-tab.active {
            border-bottom: 3px solid #5D5CDE;
            color: #5D5CDE;
            font-weight: 600;
        }
        .rubric-annotation {
            cursor: pointer;
            position: relative;
        }
        .rubric-annotation:hover {
            background-color: rgba(251, 191, 36, 0.2);
        }
        .annotation-popup {
            display: none;
            position: absolute;
            z-index: 10;
            background: white;
            border: 2px solid #5D5CDE;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-width: 250px;
        }
        .dark .annotation-popup {
            background: #1f2937;
        }
        .rubric-annotation:hover .annotation-popup {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-[#181818] text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-primary mb-2 text-center">AI Essay Training Mode</h1>
            <p class="text-base md:text-lg text-gray-600 dark:text-gray-400 text-center">LANG 0036 - Remedial English Course</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md mb-6 overflow-x-auto">
            <div class="flex border-b border-gray-200 dark:border-gray-700 min-w-max">
                <div class="nav-tab active px-4 md:px-6 py-3 md:py-4 text-sm md:text-base" data-tab="reference">
                    üìö Reference
                </div>
                <div class="nav-tab px-4 md:px-6 py-3 md:py-4 text-sm md:text-base" data-tab="goals">
                    üéØ Goals
                </div>
                <div class="nav-tab px-4 md:px-6 py-3 md:py-4 text-sm md:text-base" data-tab="thesis">
                    ‚úèÔ∏è Thesis
                </div>
                <div class="nav-tab px-4 md:px-6 py-3 md:py-4 text-sm md:text-base" data-tab="topic-sentences">
                    üîó Topic Sentences
                </div>
                <div class="nav-tab px-4 md:px-6 py-3 md:py-4 text-sm md:text-base" data-tab="body-paragraph">
                    üìù Body Paragraph
                </div>
                <div class="nav-tab px-4 md:px-6 py-3 md:py-4 text-sm md:text-base" data-tab="reflection">
                    üí≠ Reflection
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Left Panel: Task-specific content (2 columns) -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Tab 1: Reference -->
                <div id="tab-reference" class="tab-content">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                        <h2 class="text-xl md:text-2xl font-bold mb-4 text-primary">Reference Materials</h2>

                        <!-- Assessment Rubric -->
                        <div class="mb-6">
                            <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
                                <span class="text-2xl">üìä</span>
                                Essay Assessment Rubric
                            </h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500">
                                    <h4 class="font-bold text-blue-900 dark:text-blue-200 mb-2">Content and Ideas (1-5)</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300">Clear viewpoint, relevant ideas, addresses the question directly</p>
                                </div>
                                <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                                    <h4 class="font-bold text-green-900 dark:text-green-200 mb-2">Organisation & Logic (1-5)</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300">Well-structured, clear paragraphs, logical flow</p>
                                </div>
                                <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-l-4 border-purple-500">
                                    <h4 class="font-bold text-purple-900 dark:text-purple-200 mb-2">Vocabulary (1-5)</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300">Varied and precise word choice, appropriate register</p>
                                </div>
                                <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-l-4 border-orange-500">
                                    <h4 class="font-bold text-orange-900 dark:text-orange-200 mb-2">Grammar & Structure (1-5)</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300">Accurate grammar, varied sentence structures</p>
                                </div>
                            </div>
                        </div>

                        <!-- Russell Model Essay -->
                        <div class="mb-6">
                            <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
                                <span class="text-2xl">üìö</span>
                                Model Essay: "What I Have Lived For" by Bertrand Russell
                            </h3>

                            <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500 mb-4">
                                <p class="text-sm md:text-base font-medium mb-2 text-green-800 dark:text-green-300">Essay Question:</p>
                                <p class="text-sm md:text-base text-gray-800 dark:text-gray-200">"What I Have Lived For" - Write about the main purposes in your life.</p>
                            </div>

                            <div class="space-y-4 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                                <div class="rubric-annotation">
                                    <p class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed mb-3">
                                        <span class="font-semibold text-primary">[Introduction]</span> Throughout my life, I have been driven by powerful forces that have shaped who I am and what I value. <span class="bg-yellow-200 dark:bg-yellow-700 px-1 font-medium">Three passions, simple but overwhelmingly strong, have governed my life: the longing for love, the search for knowledge, and unbearable pity for the suffering of mankind.</span>
                                    </p>
                                    <div class="annotation-popup">
                                        <p class="text-xs font-bold text-primary mb-1">‚úì Content & Ideas (5/5)</p>
                                        <p class="text-xs text-gray-700 dark:text-gray-300">Clear thesis with 3 specific points directly answers the question</p>
                                        <p class="text-xs font-bold text-primary mb-1 mt-2">‚úì Organisation (5/5)</p>
                                        <p class="text-xs text-gray-700 dark:text-gray-300">Strong thesis at end of introduction sets up essay structure</p>
                                    </div>
                                </div>

                                <div class="rubric-annotation">
                                    <p class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed mb-3">
                                        <span class="font-semibold text-blue-600 dark:text-blue-400">[Body 1]</span> <span class="bg-blue-100 dark:bg-blue-900/40 px-1">I have sought love, first, because it brings ecstasy</span> - ecstasy so great that I would often have sacrificed all the rest of my life for a few hours of this joy. I have sought it, next, because it relieves loneliness - that terrible loneliness in which one shivering consciousness looks over the rim of the world into the cold unfathomable lifeless abyss.
                                    </p>
                                    <div class="annotation-popup">
                                        <p class="text-xs font-bold text-primary mb-1">‚úì Organisation (5/5)</p>
                                        <p class="text-xs text-gray-700 dark:text-gray-300">Topic sentence echoes "love" from thesis point 1</p>
                                        <p class="text-xs font-bold text-primary mb-1 mt-2">‚úì Content (5/5)</p>
                                        <p class="text-xs text-gray-700 dark:text-gray-300">Detailed development with specific reasons</p>
                                    </div>
                                </div>

                                <div class="rubric-annotation">
                                    <p class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed mb-3">
                                        <span class="font-semibold text-blue-600 dark:text-blue-400">[Body 2]</span> <span class="bg-blue-100 dark:bg-blue-900/40 px-1">With equal passion I have sought knowledge.</span> I have wished to understand the hearts of men. I have wished to know why the stars shine. And I have tried to apprehend the Pythagorean power by which number holds sway above the flux.
                                    </p>
                                    <div class="annotation-popup">
                                        <p class="text-xs font-bold text-primary mb-1">‚úì Organisation (5/5)</p>
                                        <p class="text-xs text-gray-700 dark:text-gray-300">Topic sentence echoes "knowledge" from thesis point 2</p>
                                    </div>
                                </div>

                                <div class="rubric-annotation">
                                    <p class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed">
                                        <span class="font-semibold text-blue-600 dark:text-blue-400">[Body 3]</span> <span class="bg-blue-100 dark:bg-blue-900/40 px-1">Love and knowledge, so far as they were possible, led upward toward the heavens. But always pity brought me back to earth.</span> Echoes of cries of pain reverberate in my heart. Children in famine, victims tortured by oppressors, helpless old people make a mockery of what human life should be.
                                    </p>
                                    <div class="annotation-popup">
                                        <p class="text-xs font-bold text-primary mb-1">‚úì Organisation (5/5)</p>
                                        <p class="text-xs text-gray-700 dark:text-gray-300">Topic sentence connects to "pity" from thesis point 3</p>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-300 dark:border-blue-700">
                                <p class="text-xs md:text-sm text-blue-900 dark:text-blue-200">
                                    <strong>üí° Hover over paragraphs</strong> to see how this essay meets rubric criteria. Notice how the thesis (yellow) lists 3 clear points, and each topic sentence (blue) echoes ONE point.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: Goals -->
                <div id="tab-goals" class="tab-content hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                        <h2 class="text-xl md:text-2xl font-bold mb-4 text-primary">Your Revision Goals</h2>

                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-3 flex items-center gap-2">
                                <span class="text-xl">üéØ</span>
                                Select Your Focus Areas
                            </h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Choose what you want to work on in this session:</p>

                            <div class="space-y-3">
                                <label class="flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                    <input type="checkbox" class="goal-checkbox mt-1" value="thesis" checked>
                                    <div>
                                        <p class="font-medium">Improve thesis statement clarity</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Ensure it answers the question and includes 2 specific points</p>
                                    </div>
                                </label>
                                <label class="flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                    <input type="checkbox" class="goal-checkbox mt-1" value="topic-sentences" checked>
                                    <div>
                                        <p class="font-medium">Strengthen topic sentences</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Make them echo and support thesis points</p>
                                    </div>
                                </label>
                                <label class="flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600">
                                    <input type="checkbox" class="goal-checkbox mt-1" value="paragraph-development" checked>
                                    <div>
                                        <p class="font-medium">Enhance body paragraph development</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Focus on one paragraph to improve detail and coherence</p>
                                    </div>
                                </label>
                            </div>

                            <div class="mt-4">
                                <label class="block text-sm font-medium mb-2">Add custom goals (optional):</label>
                                <textarea id="custom-goals" rows="2" placeholder="E.g., Improve vocabulary variety, fix grammar issues..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary"></textarea>
                            </div>
                        </div>

                        <div id="selected-goals-summary" class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                            <h4 class="font-bold text-green-900 dark:text-green-200 mb-2">Your Selected Goals:</h4>
                            <div id="goals-list" class="text-sm text-gray-700 dark:text-gray-300"></div>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: Thesis -->
                <div id="tab-thesis" class="tab-content hidden">
                    <div class="space-y-6">
                        <!-- Student Essay -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h2 class="text-xl font-bold mb-4 text-primary">Your Essay</h2>
                            <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-l-4 border-orange-500 mb-4">
                                <p class="text-sm md:text-base font-medium mb-2 text-orange-800 dark:text-orange-300">Essay Question:</p>
                                <p class="text-sm md:text-base text-gray-800 dark:text-gray-200">Some people believe that individual actions are insignificant in the fight against climate change compared to the efforts of governments and large corporations. To what extent do you agree or disagree with this statement?</p>
                            </div>

                            <div class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-gray-300 dark:border-gray-600">
                                <div class="text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">[Introduction]</div>
                                <p id="student-intro" class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed">
                                    <span class="sentence-highlight" data-sentence="1">Climate change, it is very huge problem now.</span>
                                    <span class="sentence-highlight" data-sentence="2">I think individual actions not so important like what government and big companies do.</span>
                                    <span class="sentence-highlight" data-sentence="3">But still, I kinda disagree because people also can do stuff to help.</span>
                                    <span class="sentence-highlight" data-sentence="4">I will explain my thoughts here.</span>
                                </p>
                            </div>
                        </div>

                        <!-- Thesis Work Area -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h3 class="text-lg font-bold mb-4">Step 1: Locate the Thesis Statement</h3>
                            <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500 mb-4">
                                <p class="text-sm text-blue-900 dark:text-blue-200">
                                    Click on the sentence above that you think is the thesis statement.
                                </p>
                            </div>
                            <div id="thesis-selection" class="hidden mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                                <p class="text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">You selected:</p>
                                <p class="text-sm font-medium" id="selected-thesis"></p>
                            </div>
                        </div>

                        <!-- Assessment Inputs -->
                        <div id="thesis-assessment" class="hidden bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h3 class="text-lg font-bold mb-4">Step 2: Assess Your Thesis</h3>

                            <div class="space-y-4">
                                <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-l-4 border-purple-500">
                                    <label class="block text-sm font-bold mb-2 text-purple-900 dark:text-purple-200">
                                        Does your thesis directly answer the essay question?
                                    </label>
                                    <textarea id="assess-question" rows="3" placeholder="Explain why or why not..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                    <button id="ask-question-alignment" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                        üí¨ Ask AI for Feedback
                                    </button>
                                </div>

                                <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                                    <label class="block text-sm font-bold mb-2 text-green-900 dark:text-green-200">
                                        Does your thesis include 2 specific points that can be developed?
                                    </label>
                                    <textarea id="assess-points" rows="3" placeholder="List the points you see (if any)..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                    <button id="ask-points-check" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                        üéØ Ask AI for Feedback
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Revision Area -->
                        <div id="thesis-revision" class="hidden bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h3 class="text-lg font-bold mb-4">Step 3: Revise Your Thesis</h3>

                            <div class="mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                                <p class="text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">Original thesis:</p>
                                <p class="text-sm" id="original-thesis"></p>
                            </div>

                            <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-l-4 border-orange-500 mb-4">
                                <label class="block text-sm font-bold mb-2 text-orange-900 dark:text-orange-200">
                                    Write your improved thesis (following Russell model)
                                </label>
                                <textarea id="revised-thesis" rows="3" placeholder="Following Russell's pattern: 'Two/Three [specific things] have [action verb]...'" class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                <button id="ask-thesis-revision" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                    ‚úèÔ∏è Ask AI to Review Revision
                                </button>
                            </div>

                            <!-- Critical Review Embedded -->
                            <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
                                <h4 class="font-bold text-yellow-900 dark:text-yellow-200 mb-2">üí° Critical Thinking</h4>
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">Ask the AI to explain its suggestions or challenge them:</p>
                                <textarea id="critical-thesis-question" rows="2" placeholder="E.g., 'Why is this suggestion better?' or 'What if I keep my original approach?'" class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                <button id="ask-critical-thesis" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                    ‚ùì Ask Critical Question
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 4: Topic Sentences -->
                <div id="tab-topic-sentences" class="tab-content hidden">
                    <div class="space-y-6">
                        <!-- Student Body Paragraphs -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h2 class="text-xl font-bold mb-4 text-primary">Body Paragraphs</h2>

                            <div id="body-para-1" class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-gray-300 dark:border-gray-600 mb-4">
                                <div class="text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">[Body Paragraph 1]</div>
                                <p class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed">
                                    <span class="sentence-highlight topic-sent" data-topic="1">First, governments and companies, they got more power.</span> They can do big things. Like, government make laws for no pollution. They can stop plastic bags or tell factories to not make so much smoke. Companies also can change their ways. They can use less energy or make stuff that don't hurt environment. This is good because it change many people life at once. So powerful, you know.
                                </p>
                            </div>

                            <div id="body-para-2" class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-gray-300 dark:border-gray-600">
                                <div class="text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">[Body Paragraph 2]</div>
                                <p class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed">
                                    <span class="sentence-highlight topic-sent" data-topic="2">But individual actions, they matter too, I guess.</span> If many people do little things, it add up. Like, turn off lights at home save energy. Or buy things from green companies. Then companies think, oh, we must be green to sell more. But sometimes it hard to know if this really work. People don't always do it. Also, one person doing something. It not enough.
                                </p>
                            </div>
                        </div>

                        <!-- Topic Sentences Work -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h3 class="text-lg font-bold mb-4">Step 1: Locate Topic Sentences</h3>
                            <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500 mb-4">
                                <p class="text-sm text-blue-900 dark:text-blue-200">
                                    Click on the first sentence of each body paragraph (the topic sentence).
                                </p>
                            </div>
                            <div id="topic-selection" class="hidden space-y-2">
                                <div class="p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                                    <p class="text-xs font-medium text-gray-600 dark:text-gray-400">Topic Sentence 1:</p>
                                    <p class="text-sm" id="selected-topic-1"></p>
                                </div>
                                <div class="p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                                    <p class="text-xs font-medium text-gray-600 dark:text-gray-400">Topic Sentence 2:</p>
                                    <p class="text-sm" id="selected-topic-2"></p>
                                </div>
                            </div>
                        </div>

                        <!-- Assessment -->
                        <div id="topic-assessment" class="hidden bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h3 class="text-lg font-bold mb-4">Step 2: Assess Topic Sentences</h3>

                            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-l-4 border-purple-500">
                                <label class="block text-sm font-bold mb-2 text-purple-900 dark:text-purple-200">
                                    Do your topic sentences echo and support the points in your thesis?
                                </label>
                                <div class="mb-3 p-2 bg-white dark:bg-gray-700 rounded text-xs">
                                    <strong>Your thesis:</strong> <span id="thesis-for-topic-check"></span>
                                </div>
                                <textarea id="assess-topic-connection" rows="4" placeholder="Explain how each topic sentence connects to a thesis point..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                <button id="ask-topic-assessment" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                    üí¨ Ask AI for Feedback
                                </button>
                            </div>
                        </div>

                        <!-- Revision -->
                        <div id="topic-revision" class="hidden bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h3 class="text-lg font-bold mb-4">Step 3: Revise Topic Sentences</h3>

                            <div class="space-y-4">
                                <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-l-4 border-orange-500">
                                    <label class="block text-sm font-bold mb-2 text-orange-900 dark:text-orange-200">
                                        Body Paragraph 1 - Revised Topic Sentence:
                                    </label>
                                    <textarea id="revised-topic-1" rows="2" placeholder="Write improved topic sentence that echoes a thesis point..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary"></textarea>
                                </div>

                                <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-l-4 border-orange-500">
                                    <label class="block text-sm font-bold mb-2 text-orange-900 dark:text-orange-200">
                                        Body Paragraph 2 - Revised Topic Sentence:
                                    </label>
                                    <textarea id="revised-topic-2" rows="2" placeholder="Write improved topic sentence that echoes a thesis point..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                    <button id="ask-topic-revision" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                        ‚úèÔ∏è Ask AI to Review Revisions
                                    </button>
                                </div>

                                <!-- Critical Review Embedded -->
                                <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
                                    <h4 class="font-bold text-yellow-900 dark:text-yellow-200 mb-2">üí° Critical Thinking</h4>
                                    <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">Question the AI's suggestions:</p>
                                    <textarea id="critical-topic-question" rows="2" placeholder="E.g., 'How does this better connect to my thesis?' or 'What other approaches could work?'" class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                    <button id="ask-critical-topic" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                        ‚ùì Ask Critical Question
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 5: Body Paragraph -->
                <div id="tab-body-paragraph" class="tab-content hidden">
                    <div class="space-y-6">
                        <!-- Paragraph Selection -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h2 class="text-xl font-bold mb-4 text-primary">Focus on One Body Paragraph</h2>

                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Select a paragraph to revise:</label>
                                <select id="paragraph-select" class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary">
                                    <option value="1">Body Paragraph 1</option>
                                    <option value="2">Body Paragraph 2</option>
                                </select>
                            </div>

                            <div id="selected-paragraph" class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-gray-300 dark:border-gray-600">
                                <div class="text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">[Body Paragraph 1]</div>
                                <p class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed" id="paragraph-text">
                                    First, governments and companies, they got more power. They can do big things. Like, government make laws for no pollution. They can stop plastic bags or tell factories to not make so much smoke. Companies also can change their ways. They can use less energy or make stuff that don't hurt environment. This is good because it change many people life at once. So powerful, you know.
                                </p>
                            </div>
                        </div>

                        <!-- Assessment -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h3 class="text-lg font-bold mb-4">Step 1: Identify ONE Issue to Address</h3>

                            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-l-4 border-purple-500">
                                <label class="block text-sm font-bold mb-2 text-purple-900 dark:text-purple-200">
                                    What is ONE specific issue with this paragraph's development?
                                </label>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">Consider: clarity, evidence, coherence, grammar, or detail</p>
                                <textarea id="identify-paragraph-issue" rows="3" placeholder="Describe one specific issue you see..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                <button id="ask-paragraph-issue" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                    üí¨ Ask AI to Identify/Confirm Issue
                                </button>
                            </div>
                        </div>

                        <!-- Revision -->
                        <div id="paragraph-revision" class="hidden bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                            <h3 class="text-lg font-bold mb-4">Step 2: Revise to Address the Issue</h3>

                            <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-l-4 border-orange-500 mb-4">
                                <label class="block text-sm font-bold mb-2 text-orange-900 dark:text-orange-200">
                                    Rewrite the paragraph addressing the ONE issue identified:
                                </label>
                                <textarea id="revised-paragraph" rows="6" placeholder="Write your revised paragraph here..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                <button id="ask-paragraph-revision" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                    ‚úèÔ∏è Ask AI to Review Revision
                                </button>
                            </div>

                            <!-- Critical Review Embedded -->
                            <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
                                <h4 class="font-bold text-yellow-900 dark:text-yellow-200 mb-2">üí° Critical Thinking</h4>
                                <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">Challenge or question the feedback:</p>
                                <textarea id="critical-paragraph-question" rows="2" placeholder="E.g., 'Is there another way to address this?' or 'Why is this approach better?'" class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                                <button id="ask-critical-paragraph" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                                    ‚ùì Ask Critical Question
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 6: Reflection -->
                <div id="tab-reflection" class="tab-content hidden">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                        <h2 class="text-xl md:text-2xl font-bold mb-4 text-primary">Final Reflection</h2>

                        <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border-l-4 border-blue-500 mb-6">
                            <h3 class="font-bold text-blue-900 dark:text-blue-200 mb-3">Reflect on your revision process</h3>
                            <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">What did you learn? What improved? What challenges did you face?</p>
                            <textarea id="final-reflection" rows="8" placeholder="Write your reflection here..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                            <button id="submit-reflection" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                                üí≠ Submit Reflection
                            </button>
                        </div>

                        <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                            <h3 class="font-bold text-green-900 dark:text-green-200 mb-2">‚úì Training Complete!</h3>
                            <p class="text-sm text-gray-700 dark:text-gray-300">You've worked through the essay revision process. Review your AI conversations on the right to see your progress.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: AI Conversation (1 column) -->
            <div class="lg:col-span-1">
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md sticky top-6">
                    <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="text-2xl">ü§ñ</span>
                        AI Conversation
                    </h3>

                    <div id="chat-messages" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4 overflow-y-auto" style="height: 500px;">
                        <div class="text-center text-gray-500 dark:text-gray-400 text-sm py-12">
                            Your conversation with the AI will appear here. Ask questions, get feedback, and engage in multiple rounds of dialogue.
                        </div>
                    </div>

                    <div id="loading-indicator" class="hidden text-center py-4">
                        <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
                        <p class="mt-2 text-xs text-gray-600 dark:text-gray-400">AI is thinking...</p>
                    </div>

                    <!-- General Chat Input -->
                    <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                        <textarea id="general-chat-input" rows="3" placeholder="Ask the AI anything about your essay..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                        <button id="send-general-chat" class="w-full bg-primary hover:bg-primary-hover text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            Send Message
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            document.documentElement.classList.add(event.matches ? 'dark' : '');
            !event.matches && document.documentElement.classList.remove('dark');
        });

        // State
        const state = {
            currentTab: 'reference',
            selectedThesis: '',
            revisedThesis: '',
            selectedTopics: { 1: '', 2: '' },
            paragraphs: {
                1: "First, governments and companies, they got more power. They can do big things. Like, government make laws for no pollution. They can stop plastic bags or tell factories to not make so much smoke. Companies also can change their ways. They can use less energy or make stuff that don't hurt environment. This is good because it change many people life at once. So powerful, you know.",
                2: "But individual actions, they matter too, I guess. If many people do little things, it add up. Like, turn off lights at home save energy. Or buy things from green companies. Then companies think, oh, we must be green to sell more. But sometimes it hard to know if this really work. People don't always do it. Also, one person doing something. It not enough."
            }
        };

        // Tab Navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        function switchTab(tabName) {
            // Update tabs
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');

            state.currentTab = tabName;
        }

        // Goals tracking
        const goalCheckboxes = document.querySelectorAll('.goal-checkbox');
        goalCheckboxes.forEach(cb => cb.addEventListener('change', updateGoals));
        document.getElementById('custom-goals').addEventListener('input', updateGoals);

        function updateGoals() {
            const goals = [];
            goalCheckboxes.forEach(cb => {
                if (cb.checked) {
                    goals.push(cb.parentElement.querySelector('p.font-medium').textContent);
                }
            });
            const custom = document.getElementById('custom-goals').value.trim();
            if (custom) goals.push(custom);

            document.getElementById('goals-list').innerHTML = goals.length > 0
                ? goals.map((g, i) => `<p>${i + 1}. ${g}</p>`).join('')
                : '<p class="text-gray-500">No goals selected</p>';
        }
        updateGoals();

        // Thesis: Locate
        document.querySelectorAll('#student-intro .sentence-highlight').forEach(sent => {
            sent.addEventListener('click', () => {
                document.querySelectorAll('#student-intro .sentence-highlight').forEach(s => {
                    s.classList.remove('sentence-selected');
                });
                sent.classList.add('sentence-selected');
                state.selectedThesis = sent.textContent.trim();
                document.getElementById('selected-thesis').textContent = state.selectedThesis;
                document.getElementById('thesis-selection').classList.remove('hidden');
                document.getElementById('thesis-assessment').classList.remove('hidden');
                document.getElementById('original-thesis').textContent = state.selectedThesis;
                document.getElementById('thesis-for-topic-check').textContent = state.selectedThesis;
            });
        });

        // Custom modal function
        function showCustomModal(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full border-2 border-primary">
                    <p class="text-gray-800 dark:text-gray-200 mb-4 text-base">${message}</p>
                    <button class="w-full px-4 py-2 bg-primary text-white hover:bg-primary-hover rounded-lg transition-colors font-semibold" onclick="this.closest('.fixed').remove()">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Thesis: Assessment buttons
        document.getElementById('ask-question-alignment').addEventListener('click', () => {
            const input = document.getElementById('assess-question').value.trim();
            if (!input) { showCustomModal('Please explain your thinking first.'); return; }
            askAI(`@Claude-Sonnet-4.5 Essay Question: "Some people believe that individual actions are insignificant in the fight against climate change compared to the efforts of governments and large corporations. To what extent do you agree or disagree with this statement?"

Thesis: "${state.selectedThesis}"
Student's analysis: "${input}"

Does this thesis directly answer the essay question? Provide feedback on the student's analysis. Keep response under 4 sentences.`);
            document.getElementById('thesis-revision').classList.remove('hidden');
        });

        document.getElementById('ask-points-check').addEventListener('click', () => {
            const input = document.getElementById('assess-points').value.trim();
            if (!input) { showCustomModal('Please list the points first.'); return; }
            askAI(`@Claude-Sonnet-4.5 Thesis: "${state.selectedThesis}"
Student identified: "${input}"

Does this thesis contain 2 specific points following Russell's model? Provide feedback. Keep response under 4 sentences.`);
            document.getElementById('thesis-revision').classList.remove('hidden');
        });

        document.getElementById('ask-thesis-revision').addEventListener('click', () => {
            const revised = document.getElementById('revised-thesis').value.trim();
            if (!revised) { showCustomModal('Please write a revised thesis first.'); return; }
            state.revisedThesis = revised;
            askAI(`@Claude-Sonnet-4.5 Original: "${state.selectedThesis}"
Revised: "${revised}"

Assess: 1) Does it answer the question? 2) Does it contain 2 specific points? Provide feedback in 4-5 sentences.`);
        });

        document.getElementById('ask-critical-thesis').addEventListener('click', () => {
            const q = document.getElementById('critical-thesis-question').value.trim();
            if (!q) { showCustomModal('Please ask a question first.'); return; }
            askAI(`@Claude-Sonnet-4.5 Student question about thesis revision: "${q}"

Provide educational explanation. Keep response under 5 sentences.`);
        });

        // Topic Sentences: Locate
        document.querySelectorAll('.topic-sent').forEach(sent => {
            sent.addEventListener('click', () => {
                sent.classList.toggle('sentence-selected');
                const topicNum = sent.getAttribute('data-topic');
                state.selectedTopics[topicNum] = sent.classList.contains('sentence-selected') ? sent.textContent.trim() : '';
                document.getElementById(`selected-topic-${topicNum}`).textContent = state.selectedTopics[topicNum];

                if (state.selectedTopics[1] && state.selectedTopics[2]) {
                    document.getElementById('topic-selection').classList.remove('hidden');
                    document.getElementById('topic-assessment').classList.remove('hidden');
                }
            });
        });

        document.getElementById('ask-topic-assessment').addEventListener('click', () => {
            const input = document.getElementById('assess-topic-connection').value.trim();
            if (!input) { showCustomModal('Please explain the connection first.'); return; }
            askAI(`@Claude-Sonnet-4.5 Thesis: "${state.revisedThesis || state.selectedThesis}"
Topic 1: "${state.selectedTopics[1]}"
Topic 2: "${state.selectedTopics[2]}"
Student's analysis: "${input}"

Do these topic sentences echo thesis points? Provide feedback. Keep response under 5 sentences.`);
            document.getElementById('topic-revision').classList.remove('hidden');
        });

        document.getElementById('ask-topic-revision').addEventListener('click', () => {
            const t1 = document.getElementById('revised-topic-1').value.trim();
            const t2 = document.getElementById('revised-topic-2').value.trim();
            if (!t1 || !t2) { showCustomModal('Please revise both topic sentences.'); return; }
            askAI(`@Claude-Sonnet-4.5 Revised topic sentences:
1: "${t1}"
2: "${t2}"

Do these clearly connect to thesis points? Provide feedback in 4-5 sentences.`);
        });

        document.getElementById('ask-critical-topic').addEventListener('click', () => {
            const q = document.getElementById('critical-topic-question').value.trim();
            if (!q) { showCustomModal('Please ask a question.'); return; }
            askAI(`@Claude-Sonnet-4.5 Student question about topic sentences: "${q}"

Provide clear explanation. Keep response under 5 sentences.`);
        });

        // Body Paragraph
        document.getElementById('paragraph-select').addEventListener('change', (e) => {
            const paraNum = e.target.value;
            document.getElementById('paragraph-text').textContent = state.paragraphs[paraNum];
        });

        document.getElementById('ask-paragraph-issue').addEventListener('click', () => {
            const input = document.getElementById('identify-paragraph-issue').value.trim();
            const paraNum = document.getElementById('paragraph-select').value;
            const para = state.paragraphs[paraNum];

            askAI(`@Claude-Sonnet-4.5 Body paragraph: "${para}"
Student identified issue: "${input || 'Please identify ONE issue'}"

Confirm or identify ONE specific issue to address. Keep response under 4 sentences.`);
            document.getElementById('paragraph-revision').classList.remove('hidden');
        });

        document.getElementById('ask-paragraph-revision').addEventListener('click', () => {
            const revised = document.getElementById('revised-paragraph').value.trim();
            if (!revised) { showCustomModal('Please write revised paragraph.'); return; }
            askAI(`@Claude-Sonnet-4.5 Revised paragraph: "${revised}"

Did the student successfully address the issue? Provide feedback in 4-5 sentences.`);
        });

        document.getElementById('ask-critical-paragraph').addEventListener('click', () => {
            const q = document.getElementById('critical-paragraph-question').value.trim();
            if (!q) { showCustomModal('Please ask a question.'); return; }
            askAI(`@Claude-Sonnet-4.5 Student question about paragraph revision: "${q}"

Provide thoughtful explanation. Keep response under 5 sentences.`);
        });

        // Reflection
        document.getElementById('submit-reflection').addEventListener('click', () => {
            const reflection = document.getElementById('final-reflection').value.trim();
            if (!reflection) { showCustomModal('Please write your reflection.'); return; }
            askAI(`@Claude-Sonnet-4.5 Student's reflection: "${reflection}"

Provide feedback on their metacognitive awareness and growth. Keep response under 5 sentences.`);
        });

        // General chat
        document.getElementById('send-general-chat').addEventListener('click', () => {
            const msg = document.getElementById('general-chat-input').value.trim();
            if (!msg) return;
            askAI(`@Claude-Sonnet-4.5 ${msg}`);
            document.getElementById('general-chat-input').value = '';
        });

        // AI Communication
        function addChatMessage(sender, content) {
            const chat = document.getElementById('chat-messages');
            const placeholder = chat.querySelector('.text-center.text-gray-500');
            if (placeholder) placeholder.remove();

            const msg = document.createElement('div');
            msg.className = 'mb-3';
            msg.innerHTML = `
                <div class="text-xs font-semibold mb-1 ${sender === 'You' ? 'text-gray-600 dark:text-gray-400' : 'text-primary'}">${sender === 'You' ? 'üë§' : 'ü§ñ'} ${sender}</div>
                <div class="p-3 rounded-lg text-sm ${sender === 'You' ? 'bg-gray-200 dark:bg-gray-600' : 'bg-blue-50 dark:bg-blue-900/30'}">${marked.parse(content)}</div>
            `;
            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight;
        }

        function updateLastAIMessage(content) {
            const chat = document.getElementById('chat-messages');
            const messages = chat.querySelectorAll('.mb-3');
            if (messages.length > 0) {
                const last = messages[messages.length - 1];
                const contentDiv = last.querySelector('.p-3');
                if (contentDiv) {
                    contentDiv.innerHTML = marked.parse(content);
                    chat.scrollTop = chat.scrollHeight;
                }
            }
        }

        if (window.Poe) {
            window.Poe.registerHandler("essay-training", (result) => {
                const msg = result.responses[0];
                document.getElementById('loading-indicator').classList.add('hidden');

                if (msg.status === "error") {
                    addChatMessage("AI", `Error: ${msg.statusText}`);
                } else if (msg.status === "incomplete") {
                    if (msg.content.trim()) {
                        updateLastAIMessage(msg.content);
                    }
                } else if (msg.status === "complete") {
                    updateLastAIMessage(msg.content);
                }
            });
        }

        async function askAI(prompt) {
            if (!window.Poe) {
                showCustomModal("Poe API not available. This app needs to run in the Poe environment.");
                return;
            }

            // Extract user message from prompt
            const userMsg = prompt.split('\n').slice(1).join('\n').substring(0, 100) + '...';
            addChatMessage("You", userMsg);
            addChatMessage("AI", "...");
            document.getElementById('loading-indicator').classList.remove('hidden');

            try {
                await window.Poe.sendUserMessage(prompt, {
                    handler: "essay-training",
                    stream: true,
                    openChat: false
                });
            } catch (err) {
                document.getElementById('loading-indicator').classList.add('hidden');
                addChatMessage("AI", `Error: ${err.message}`);
            }
        }

        console.log('AI Essay Training Mode loaded');
    </script>
</body>
</html>

