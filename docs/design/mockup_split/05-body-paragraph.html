<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Paragraph - AI Essay Training Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-hover': '#4a49c5',
                        'primary-light': '#ebebfa',
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-[#181818] text-gray-900 dark:text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-primary mb-2 text-center">Body Paragraph Development</h1>
            <p class="text-base md:text-lg text-gray-600 dark:text-gray-400 text-center">Focus on improving one body paragraph</p>
        </header>

        <!-- Main Content Grid -->
        <div class="grid lg:grid-cols-3 gap-6">
            <!-- Left Panel: Body Paragraph Work (2 columns) -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Thesis Statement Display -->
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                    <h2 class="text-xl font-bold mb-4 text-primary">Your Thesis Statement</h2>
                    
                    <div class="mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded-lg">
                        <p class="text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">Original thesis:</p>
                        <p class="text-sm" id="original-thesis-display">I think individual actions not so important like what government and big companies do. But still, I kinda disagree because people also can do stuff to help.</p>
                    </div>

                    <div class="p-3 bg-green-100 dark:bg-green-800/30 rounded-lg border-l-4 border-green-500">
                        <p class="text-xs font-medium text-green-800 dark:text-green-200 mb-1">Revised thesis:</p>
                        <p class="text-sm font-medium text-green-900 dark:text-green-100" id="revised-thesis-display">I partially agree because while individual actions create collective impact through social movements, government policies have greater immediate effect on climate change.</p>
                    </div>
                </div>

                <!-- Paragraph Selection -->
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                    <h2 class="text-xl font-bold mb-4 text-primary">Focus on One Body Paragraph</h2>

                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2">Select a paragraph to revise:</label>
                        <select id="paragraph-select" class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary">
                            <option value="1">Body Paragraph 1</option>
                            <option value="2">Body Paragraph 2</option>
                        </select>
                    </div>

                    <div id="selected-paragraph" class="p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border-2 border-gray-300 dark:border-gray-600">
                        <div class="text-xs md:text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">[Body Paragraph 1]</div>
                        <p class="text-sm md:text-base text-gray-800 dark:text-gray-200 leading-relaxed" id="paragraph-text">
                            First, governments and companies, they got more power. They can do big things. Like, government make laws for no pollution. They can stop plastic bags or tell factories to not make so much smoke. Companies also can change their ways. They can use less energy or make stuff that don't hurt environment. This is good because it change many people life at once. So powerful, you know.
                        </p>
                    </div>
                </div>

                <!-- Assessment -->
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                    <h3 class="text-lg font-bold mb-4">Step 1: Identify ONE Issue to Address</h3>

                    <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-l-4 border-purple-500">
                        <label class="block text-sm font-bold mb-2 text-purple-900 dark:text-purple-200">
                            What is ONE specific issue with this paragraph's development?
                        </label>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">Consider: clarity, evidence, coherence, grammar, or detail</p>
                        <textarea id="identify-paragraph-issue" rows="3" placeholder="Describe one specific issue you see..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                        <button id="ask-paragraph-issue" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                            üí¨ Ask AI to Identify/Confirm Issue
                        </button>
                    </div>
                </div>

                <!-- Revision -->
                <div id="paragraph-revision" class="hidden bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md">
                    <h3 class="text-lg font-bold mb-4">Step 2: Revise to Address the Issue</h3>

                    <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg border-l-4 border-orange-500 mb-4">
                        <label class="block text-sm font-bold mb-2 text-orange-900 dark:text-orange-200">
                            Rewrite the paragraph addressing the ONE issue identified:
                        </label>
                        <textarea id="revised-paragraph" rows="6" placeholder="Write your revised paragraph here..." class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                        <button id="ask-paragraph-revision" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                            ‚úèÔ∏è Ask AI to Review Revision
                        </button>
                    </div>

                    <!-- Critical Review Embedded -->
                    <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
                        <h4 class="font-bold text-yellow-900 dark:text-yellow-200 mb-2">üí° Critical Thinking (Goal 3)</h4>
                        <p class="text-sm text-gray-700 dark:text-gray-300 mb-3">Challenge or question the feedback:</p>
                        <textarea id="critical-paragraph-question" rows="2" placeholder="E.g., 'Is there another way to address this?' or 'Why is this approach better?'" class="w-full p-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary mb-2"></textarea>
                        <button id="ask-critical-paragraph" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors text-sm">
                            ‚ùì Ask Critical Question
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel: AI Tutoring & Comments (1 column) -->
            <div class="lg:col-span-1">
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 shadow-md sticky top-6">
                    <h3 class="text-lg md:text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="text-2xl">üë®‚Äçüè´</span>
                        AI Tutor Comments
                    </h3>

                    <!-- Progress Tracking -->
                    <div class="mb-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                        <h4 class="text-sm font-bold text-green-900 dark:text-green-200 mb-2">üìà Your Progress</h4>
                        <div class="text-xs text-green-800 dark:text-green-300 space-y-1">
                            <p><strong>Current Step:</strong> Body Paragraph Development</p>
                            <p><strong>Focus:</strong> Identifying and addressing specific issues</p>
                            <p><strong>Next:</strong> Revise based on AI feedback</p>
                        </div>
                    </div>

                    <!-- AI Tutor Feedback -->
                    <div id="tutor-feedback" class="mb-4">
                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border-l-4 border-blue-500">
                            <h4 class="text-sm font-bold text-blue-900 dark:text-blue-200 mb-2">ü§ñ AI Tutor Analysis</h4>
                            <div id="tutor-messages" class="text-sm text-blue-800 dark:text-blue-300">
                                <div class="text-center text-gray-500 dark:text-gray-400 text-xs py-4">
                                    AI tutor feedback will appear here after you submit your analysis.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Key Teaching Points -->
                    <div class="mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500">
                        <h4 class="text-sm font-bold text-yellow-900 dark:text-yellow-200 mb-2">üí° Key Teaching Points</h4>
                        <div class="text-xs text-yellow-800 dark:text-yellow-300 space-y-1">
                            <p><strong>Body paragraphs should:</strong></p>
                            <ul class="ml-3 space-y-1">
                                <li>‚Ä¢ Start with clear topic sentence</li>
                                <li>‚Ä¢ Provide specific evidence/examples</li>
                                <li>‚Ä¢ Explain how evidence supports thesis</li>
                                <li>‚Ä¢ Use clear, coherent language</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Clarification Reminders -->
                    <div class="mb-4 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border-l-4 border-purple-500">
                        <h4 class="text-sm font-bold text-purple-900 dark:text-purple-200 mb-2">‚ùì Ask for Clarification</h4>
                        <div class="text-xs text-purple-800 dark:text-purple-300 space-y-1">
                            <p><strong>Don't just accept AI suggestions!</strong></p>
                            <p>Ask: "Can you show me examples?" or "Why is this better?"</p>
                        </div>
                    </div>

                    <div id="loading-indicator" class="hidden text-center py-4">
                        <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
                        <p class="mt-2 text-xs text-gray-600 dark:text-gray-400">AI tutor is analyzing...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode setup
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            document.documentElement.classList.add(event.matches ? 'dark' : '');
            !event.matches && document.documentElement.classList.remove('dark');
        });

        // State
        const state = {
            paragraphs: {
                1: "First, governments and companies, they got more power. They can do big things. Like, government make laws for no pollution. They can stop plastic bags or tell factories to not make so much smoke. Companies also can change their ways. They can use less energy or make stuff that don't hurt environment. This is good because it change many people life at once. So powerful, you know.",
                2: "But individual actions, they matter too, I guess. If many people do little things, it add up. Like, turn off lights at home save energy. Or buy things from green companies. Then companies think, oh, we must be green to sell more. But sometimes it hard to know if this really work. People don't always do it. Also, one person doing something. It not enough."
            },
            originalThesis: 'I think individual actions not so important like what government and big companies do. But still, I kinda disagree because people also can do stuff to help.',
            revisedThesis: 'I partially agree because while individual actions create collective impact through social movements, government policies have greater immediate effect on climate change.'
        };

        // Body Paragraph
        document.getElementById('paragraph-select').addEventListener('change', (e) => {
            const paraNum = e.target.value;
            document.getElementById('paragraph-text').textContent = state.paragraphs[paraNum];
        });

        // Custom modal function
        function showCustomModal(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full border-2 border-primary">
                    <p class="text-gray-800 dark:text-gray-200 mb-4 text-base">${message}</p>
                    <button class="w-full px-4 py-2 bg-primary text-white hover:bg-primary-hover rounded-lg transition-colors font-semibold" onclick="this.closest('.fixed').remove()">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        document.getElementById('ask-paragraph-issue').addEventListener('click', () => {
            const input = document.getElementById('identify-paragraph-issue').value.trim();
            const paraNum = document.getElementById('paragraph-select').value;
            const para = state.paragraphs[paraNum];

            askAI(`@Claude-Sonnet-4.5 Original thesis: "${state.originalThesis}"
Revised thesis: "${state.revisedThesis}"
Body paragraph: "${para}"
Student identified issue: "${input || 'Please identify ONE issue'}"

DIRECTLY answer: What is the ONE specific issue with this paragraph? Provide specific feedback and concrete suggestions for improvement. Then remind the student to ask for clarification: "Can you show me examples?" or "Why is this better?" Keep response under 4 sentences.`);
            document.getElementById('paragraph-revision').classList.remove('hidden');
        });

        document.getElementById('ask-paragraph-revision').addEventListener('click', () => {
            const revised = document.getElementById('revised-paragraph').value.trim();
            if (!revised) { showCustomModal('Please write revised paragraph.'); return; }
            askAI(`@Claude-Sonnet-4.5 Revised thesis: "${state.revisedThesis}"
Revised paragraph: "${revised}"

DIRECTLY answer: Did the student successfully address the issue? Provide specific feedback and examples. Encourage the student to ask: "Can you show me examples of effective paragraphs?" or "Why is this approach better?" Provide feedback in 4-5 sentences.`);
        });

        document.getElementById('ask-critical-paragraph').addEventListener('click', () => {
            const q = document.getElementById('critical-paragraph-question').value.trim();
            if (!q) { showCustomModal('Please ask a question.'); return; }
            askAI(`@Claude-Sonnet-4.5 Student question about paragraph revision: "${q}"

Provide detailed explanation with examples and evidence. Encourage further questions like: "Can you show me more examples?" or "What are the limitations of this approach?" Keep response under 5 sentences.`);
        });

        // Note: General chat functionality removed - using tutor feedback system instead

        // AI Tutor Feedback System
        function updateTutorFeedback(content) {
            const tutorMessages = document.getElementById('tutor-messages');
            const placeholder = tutorMessages.querySelector('.text-center.text-gray-500');
            if (placeholder) placeholder.remove();

            tutorMessages.innerHTML = marked.parse(content);
        }

        function addTutorComment(content, type = 'analysis') {
            const tutorMessages = document.getElementById('tutor-messages');
            const placeholder = tutorMessages.querySelector('.text-center.text-gray-500');
            if (placeholder) placeholder.remove();

            const comment = document.createElement('div');
            comment.className = `mb-3 p-3 rounded-lg ${type === 'analysis' ? 'bg-blue-50 dark:bg-blue-900/30' : 'bg-green-50 dark:bg-green-900/30'}`;
            comment.innerHTML = marked.parse(content);
            tutorMessages.appendChild(comment);
        }

        if (window.Poe) {
            window.Poe.registerHandler("essay-training", (result) => {
                const msg = result.responses[0];
                document.getElementById('loading-indicator').classList.add('hidden');

                if (msg.status === "error") {
                    updateTutorFeedback(`**Error:** ${msg.statusText}`);
                } else if (msg.status === "incomplete") {
                    if (msg.content.trim()) {
                        updateTutorFeedback(msg.content);
                    }
                } else if (msg.status === "complete") {
                    updateTutorFeedback(msg.content);
                }
            });
        }

        async function askAI(prompt) {
            if (!window.Poe) {
                showCustomModal("Poe API not available. This app needs to run in the Poe environment.");
                return;
            }

            document.getElementById('loading-indicator').classList.remove('hidden');

            try {
                await window.Poe.sendUserMessage(prompt, {
                    handler: "essay-training",
                    stream: true,
                    openChat: false
                });
            } catch (err) {
                document.getElementById('loading-indicator').classList.add('hidden');
                updateTutorFeedback(`**Error:** ${err.message}`);
            }
        }

        console.log('Body Paragraph tab loaded');
    </script>
</body>
</html>
